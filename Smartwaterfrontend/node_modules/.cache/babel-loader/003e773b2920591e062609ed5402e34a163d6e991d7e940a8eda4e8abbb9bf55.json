{"ast":null,"code":"import React,{useEffect,useState}from'react';import api from'../api/api';import{Line}from'react-chartjs-2';import{Chart as ChartJS,CategoryScale,LinearScale,TimeScale,PointElement,LineElement,Title,Tooltip,Legend}from'chart.js';import dayjs from'dayjs';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";ChartJS.register(CategoryScale,LinearScale,TimeScale,PointElement,LineElement,Title,Tooltip,Legend);export default function ThingSpeakChart(){const[labels,setLabels]=useState([]);const[levelData,setLevelData]=useState([]);const[volumeData,setVolumeData]=useState([]);const[loading,setLoading]=useState(true);const load=async()=>{try{setLoading(true);const res=await api.get('/api/reads/recent',{params:{limit:200}});const rows=res.data||[];const asc=rows.slice().sort((a,b)=>new Date(a.created_at)-new Date(b.created_at));setLabels(asc.map(r=>dayjs(r.created_at).format('HH:mm:ss')));setLevelData(asc.map(r=>{var _r$water_level_cm;return(_r$water_level_cm=r.water_level_cm)!==null&&_r$water_level_cm!==void 0?_r$water_level_cm:null;}));setVolumeData(asc.map(r=>{var _r$volume_liters;return(_r$volume_liters=r.volume_liters)!==null&&_r$volume_liters!==void 0?_r$volume_liters:null;}));}catch(err){console.error('Chart load error',err);}finally{setLoading(false);}};useEffect(()=>{load();const t=setInterval(load,15000);return()=>clearInterval(t);},[]);const data={labels,datasets:[{label:'Level (cm)',data:levelData,yAxisID:'y1',tension:0.2,pointRadius:1},{label:'Volume (L)',data:volumeData,yAxisID:'y2',tension:0.2,pointRadius:1}]};const options={responsive:true,interaction:{mode:'index',intersect:false},stacked:false,plugins:{title:{display:true,text:'Water Level & Volume (recent)'},legend:{position:'top'}},scales:{y1:{type:'linear',display:true,position:'left',title:{display:true,text:'Level (cm)'}},y2:{type:'linear',display:true,position:'right',grid:{drawOnChartArea:false},title:{display:true,text:'Volume (L)'}}}};return/*#__PURE__*/_jsxs(\"div\",{className:\"card\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Live Chart\"}),loading?/*#__PURE__*/_jsx(\"div\",{children:\"Loading chart\\u2026\"}):/*#__PURE__*/_jsx(Line,{options:options,data:data})]});}","map":{"version":3,"names":["React","useEffect","useState","api","Line","Chart","ChartJS","CategoryScale","LinearScale","TimeScale","PointElement","LineElement","Title","Tooltip","Legend","dayjs","jsx","_jsx","jsxs","_jsxs","register","ThingSpeakChart","labels","setLabels","levelData","setLevelData","volumeData","setVolumeData","loading","setLoading","load","res","get","params","limit","rows","data","asc","slice","sort","a","b","Date","created_at","map","r","format","_r$water_level_cm","water_level_cm","_r$volume_liters","volume_liters","err","console","error","t","setInterval","clearInterval","datasets","label","yAxisID","tension","pointRadius","options","responsive","interaction","mode","intersect","stacked","plugins","title","display","text","legend","position","scales","y1","type","y2","grid","drawOnChartArea","className","children"],"sources":["C:/smart-water-project/smartwaterfrontend/src/components/ThingSpeakChart.js"],"sourcesContent":["import React, { useEffect, useState } from 'react';\r\nimport api from '../api/api';\r\nimport { Line } from 'react-chartjs-2';\r\nimport {\r\n  Chart as ChartJS,\r\n  CategoryScale,\r\n  LinearScale,\r\n  TimeScale,\r\n  PointElement,\r\n  LineElement,\r\n  Title,\r\n  Tooltip,\r\n  Legend\r\n} from 'chart.js';\r\nimport dayjs from 'dayjs';\r\n\r\nChartJS.register(\r\n  CategoryScale,\r\n  LinearScale,\r\n  TimeScale,\r\n  PointElement,\r\n  LineElement,\r\n  Title,\r\n  Tooltip,\r\n  Legend\r\n);\r\n\r\nexport default function ThingSpeakChart() {\r\n  const [labels, setLabels] = useState([]);\r\n  const [levelData, setLevelData] = useState([]);\r\n  const [volumeData, setVolumeData] = useState([]);\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  const load = async () => {\r\n    try {\r\n      setLoading(true);\r\n      const res = await api.get('/api/reads/recent', { params: { limit: 200 } });\r\n      const rows = res.data || [];\r\n      const asc = rows.slice().sort((a,b)=> new Date(a.created_at) - new Date(b.created_at));\r\n      setLabels(asc.map(r => dayjs(r.created_at).format('HH:mm:ss')));\r\n      setLevelData(asc.map(r => r.water_level_cm ?? null));\r\n      setVolumeData(asc.map(r => r.volume_liters ?? null));\r\n    } catch (err) {\r\n      console.error('Chart load error', err);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    load();\r\n    const t = setInterval(load, 15000);\r\n    return () => clearInterval(t);\r\n  }, []);\r\n\r\n  const data = {\r\n    labels,\r\n    datasets: [\r\n      {\r\n        label: 'Level (cm)',\r\n        data: levelData,\r\n        yAxisID: 'y1',\r\n        tension: 0.2,\r\n        pointRadius: 1,\r\n      },\r\n      {\r\n        label: 'Volume (L)',\r\n        data: volumeData,\r\n        yAxisID: 'y2',\r\n        tension: 0.2,\r\n        pointRadius: 1,\r\n      }\r\n    ]\r\n  };\r\n\r\n  const options = {\r\n    responsive: true,\r\n    interaction: { mode: 'index', intersect: false },\r\n    stacked: false,\r\n    plugins: {\r\n      title: { display: true, text: 'Water Level & Volume (recent)' },\r\n      legend: { position: 'top' }\r\n    },\r\n    scales: {\r\n      y1: {\r\n        type: 'linear',\r\n        display: true,\r\n        position: 'left',\r\n        title: { display: true, text: 'Level (cm)' }\r\n      },\r\n      y2: {\r\n        type: 'linear',\r\n        display: true,\r\n        position: 'right',\r\n        grid: { drawOnChartArea: false },\r\n        title: { display: true, text: 'Volume (L)' }\r\n      }\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"card\">\r\n      <h2>Live Chart</h2>\r\n      {loading ? <div>Loading chartâ€¦</div> : <Line options={options} data={data} />}\r\n    </div>\r\n  );\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}