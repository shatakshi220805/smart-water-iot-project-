{"ast":null,"code":"import React,{useState}from'react';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const DEFAULT_SERVICE='0000ffe0-0000-1000-8000-00805f9b34fb';// example, change to your service\nconst DEFAULT_CHAR='0000ffe1-0000-1000-8000-00805f9b34fb';export default function BluetoothReader(){const[status,setStatus]=useState('idle');const[deviceName,setDeviceName]=useState(null);const[bleData,setBleData]=useState(null);const[serverRef,setServerRef]=useState(null);const connect=async()=>{try{setStatus('requesting');const opts={filters:[{namePrefix:'ESP'}],// ESP32 BLE device name prefix; adjust as needed\noptionalServices:[DEFAULT_SERVICE]};const device=await navigator.bluetooth.requestDevice(opts);setDeviceName(device.name||device.id);setStatus('connecting');const server=await device.gatt.connect();setServerRef(server);const service=await server.getPrimaryService(DEFAULT_SERVICE);const char=await service.getCharacteristic(DEFAULT_CHAR);await char.startNotifications();char.addEventListener('characteristicvaluechanged',e=>{const value=new TextDecoder().decode(e.target.value);setBleData(value);});setStatus('connected');device.ongattserverdisconnected=()=>{setStatus('disconnected');};}catch(err){console.error('BLE error',err);setStatus('error');}};const disconnect=async()=>{try{if(serverRef&&serverRef.connected){serverRef.disconnect();}}catch(err){console.warn('disconnect err',err);}finally{setStatus('idle');setDeviceName(null);setBleData(null);}};return/*#__PURE__*/_jsxs(\"div\",{className:\"card\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Bluetooth (optional)\"}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Status:\"}),\" \",status]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"button\",{onClick:connect,disabled:status==='connecting'||status==='connected',children:\"Connect BLE\"}),/*#__PURE__*/_jsx(\"button\",{onClick:disconnect,disabled:status!=='connected',children:\"Disconnect\"})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Device:\"}),\" \",deviceName!==null&&deviceName!==void 0?deviceName:'—']}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Last BLE data:\"}),/*#__PURE__*/_jsx(\"pre\",{style:{whiteSpace:'pre-wrap',wordBreak:'break-word'},children:bleData!==null&&bleData!==void 0?bleData:'—'})]}),/*#__PURE__*/_jsx(\"p\",{className:\"muted\",children:\"Note: This is optional \\u2014 using ThingSpeak HTTP push is recommended for persistence.\"})]});}","map":{"version":3,"names":["React","useState","jsx","_jsx","jsxs","_jsxs","DEFAULT_SERVICE","DEFAULT_CHAR","BluetoothReader","status","setStatus","deviceName","setDeviceName","bleData","setBleData","serverRef","setServerRef","connect","opts","filters","namePrefix","optionalServices","device","navigator","bluetooth","requestDevice","name","id","server","gatt","service","getPrimaryService","char","getCharacteristic","startNotifications","addEventListener","e","value","TextDecoder","decode","target","ongattserverdisconnected","err","console","error","disconnect","connected","warn","className","children","onClick","disabled","style","whiteSpace","wordBreak"],"sources":["C:/smart-water-project/smartwaterfrontend/src/components/BluetoothReader.js"],"sourcesContent":["import React, { useState } from 'react';\r\n\r\nconst DEFAULT_SERVICE = '0000ffe0-0000-1000-8000-00805f9b34fb'; // example, change to your service\r\nconst DEFAULT_CHAR = '0000ffe1-0000-1000-8000-00805f9b34fb';\r\n\r\nexport default function BluetoothReader() {\r\n  const [status, setStatus] = useState('idle');\r\n  const [deviceName, setDeviceName] = useState(null);\r\n  const [bleData, setBleData] = useState(null);\r\n  const [serverRef, setServerRef] = useState(null);\r\n\r\n  const connect = async () => {\r\n    try {\r\n      setStatus('requesting');\r\n      const opts = {\r\n        filters: [{ namePrefix: 'ESP' }], // ESP32 BLE device name prefix; adjust as needed\r\n        optionalServices: [DEFAULT_SERVICE]\r\n      };\r\n      const device = await navigator.bluetooth.requestDevice(opts);\r\n      setDeviceName(device.name || device.id);\r\n      setStatus('connecting');\r\n      const server = await device.gatt.connect();\r\n      setServerRef(server);\r\n      const service = await server.getPrimaryService(DEFAULT_SERVICE);\r\n      const char = await service.getCharacteristic(DEFAULT_CHAR);\r\n      await char.startNotifications();\r\n      char.addEventListener('characteristicvaluechanged', e => {\r\n        const value = new TextDecoder().decode(e.target.value);\r\n        setBleData(value);\r\n      });\r\n      setStatus('connected');\r\n      device.ongattserverdisconnected = () => {\r\n        setStatus('disconnected');\r\n      };\r\n    } catch (err) {\r\n      console.error('BLE error', err);\r\n      setStatus('error');\r\n    }\r\n  };\r\n\r\n  const disconnect = async () => {\r\n    try {\r\n      if (serverRef && serverRef.connected) {\r\n        serverRef.disconnect();\r\n      }\r\n    } catch (err) {\r\n      console.warn('disconnect err', err);\r\n    } finally {\r\n      setStatus('idle');\r\n      setDeviceName(null);\r\n      setBleData(null);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"card\">\r\n      <h2>Bluetooth (optional)</h2>\r\n      <div>\r\n        <strong>Status:</strong> {status}\r\n      </div>\r\n      <div>\r\n        <button onClick={connect} disabled={status === 'connecting' || status === 'connected'}>\r\n          Connect BLE\r\n        </button>\r\n        <button onClick={disconnect} disabled={status !== 'connected'}>\r\n          Disconnect\r\n        </button>\r\n      </div>\r\n      <div>\r\n        <strong>Device:</strong> {deviceName ?? '—'}\r\n      </div>\r\n      <div>\r\n        <strong>Last BLE data:</strong>\r\n        <pre style={{whiteSpace:'pre-wrap',wordBreak:'break-word'}}>{bleData ?? '—'}</pre>\r\n      </div>\r\n      <p className=\"muted\">Note: This is optional — using ThingSpeak HTTP push is recommended for persistence.</p>\r\n    </div>\r\n  );\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}